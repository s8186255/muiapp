/*!
 * =====================================================
 * TS v1.0.0 ()
 * =====================================================
 */
!function(a,b){b.LoginPage=a.Class.extend({init:function(){this.initConfig(),this.initPage(),this.initEvent()},initConfig:function(){b.backUrl="../my/my.html",b.Login=new b.LoginClass},initPage:function(a){var c=b.User.get_user();b.template("panels","login/login",{userData:c}),b.User.isLogin()?document.getElementById("ts_info_panel").classList.remove("mui-hidden"):document.getElementById("ts_login_panel").classList.remove("mui-hidden")},initEvent:function(){var c=this;b.debug&&(document.getElementById("mobile").value="18201434299")&&(document.getElementById("sms").value="123456"),document.getElementById("get_sms").addEventListener("tap",function(){var a=this;if(!a.busying){var d=c.checkMobile();d&&(a.busying=!0,a.innerText="正在发送中",b.Api.get_sms(3,d,function(b){c.countSms(a)},function(){b.error("获取验证码失败，请重试"),a.innerText="获取验证码"}))}}),document.getElementById("login").addEventListener("tap",function(){var a=c.checkMobile(),d=c.checkSms();return a&&d&&(b.showWaiting(),b.Login.login(a,d,function(a){a&&(b.User.init(a.data),c.back()),b.closeWaiting()})),!1}),document.getElementById("logout").addEventListener("tap",function(){b.Login.logout(function(){c.back()})}),a("#oauth_login").on("tap","#wechat",function(){c.loginByWechat()}),a("#oauth_login").on("tap","#sina",function(){c.loginBySina()}),a("#oauth_login").on("tap","#qihoo",function(){c.loginByQihoo()})},countSms:function(a){var b=60,c=window.setInterval(function(){a.innerText=--b+"秒后重发",0>=b&&(window.clearInterval(c),a.busying=!1,a.innerText="获取验证码")},1e3)},loginByWechat:function(){b.Login.loginByWechat()},loginBySina:function(){b.Login.loginBySina()},loginByQq:function(){b.Login.loginByQq()},loginByQihoo:function(){b.Login.loginByQihoo()},back:function(){b.debug&&b.d("back before"),a.back(),b.debug&&b.d("back after")},checkMobile:function(){var a=document.getElementById("mobile"),c=a.value;return/^1[3|4|5|8|7][0-9]\d{4,8}$/.test(c)?c:(a.value="",b.alert("您输入的手机号码不符合格式，请重新输入！"),setTimeout(function(){a.focus()},20),!1)},checkSms:function(){var a=document.getElementById("sms"),c=a.value;return/[0-9]{6}$/.test(c)?c:(a.value="",b.alert("您输入的验证码不符合格式，请重新输入！"),setTimeout(function(){a.focus()},20),!1)}})}(mui,TS),function(a){a.os.plus&&(TS.LoginPage=TS.LoginPage.extend(a.extend(TS.AppObject,{oAuthLoginCallback:function(a,b){a?this.oAuthLoginSuccess(a.data,b):this.oAuthLoginError()},oAuthLoginSuccess:function(a,b){TS.User.init(a),TS.User.initUserinfo(b),TS.closeWaiting(),this.back()},oAuthLoginError:function(){TS.closeWaiting()},loginByWechat:function(){TS.showWaiting(),TS.Login.loginByWechat(this.oAuthLoginCallback.bind(this))},loginBySina:function(){TS.showWaiting(),TS.Login.loginBySina(this.oAuthLoginCallback.bind(this))},loginByQq:function(){TS.showWaiting(),TS.Login.loginByQq(this.oAuthLoginCallback.bind(this))},loginByQihoo:function(){TS.showWaiting(),TS.Login.loginByQihoo(this.oAuthLoginCallback.bind(this))},back:function(){a.each(plus.webview.all(),function(b,c){TS.debug&&TS.d(c.id),a.fire(c,"user_init")});var b=plus.webview.currentWebview().opener();b&&a.fire(b,b.id),a.back()}})))}(mui);