/*!
 * =====================================================
 * TS v1.0.0 ()
 * =====================================================
 */
!function(a,b){b.CombodetailPage=a.Class.extend({params:{},comboData:{},init:function(){this.initConfig(),this.initPage(),this.initEvent()},initConfig:function(){document.location.search&&(this.params=b.parseParams(document.location.search)),template.helper("priceFormat",function(a){return parseFloat(a).toFixed(2)})},initPage:function(c){var d=parseInt(this.params.id);if(d){var e=this;b.Api.get_combo_detail(d,function(d){var f=e.comboData=d.data;e.params.item_id=f.item_id,b.backUrl="../supplier/supplier.html?id="+f.item_id,document.title="挑食·火锅送 - "+f.combo_name,document.getElementById("ts_title").innerText=f.combo_name,document.getElementById("price").innerText=f.combo_curprice,b.template("combodetail","combodetail/combodetail",{comboData:f,shareData:{title:f.combo_name,content:b.share.combodetail,href:"../combodetail/combodetail.html?id="+f.combo_id}}),e.initCart(function(){var b=0;e.cart.materials.length&&a.each(e.cart.materials,function(a,c){return c.id===f.combo_id?(b=c.num,!1):void 0});var d=document.getElementById("material_num");d.innerText=b,d.classList[b?"remove":"add"]("mui-hidden"),c&&c()})})}},initEvent:function(){var c=this;a(document.body).on("tap","#ts_actions a",function(){var a=this;setTimeout(function(){a.classList.remove("mui-active")},150)}),document.getElementById("add_to_cart").addEventListener("tap",function(){b.User.isLogin()?(b.showWaiting(),c.cart.addMaterial(c.comboData.combo_id,1,c.comboData.combo_name,c.comboData.combo_curprice),c.addOrUpdateCart(function(a){c.gotoMaterial(),b.closeWaiting()})):b.openLogin()})},gotoMaterial:function(){a.back()},initCart:function(a){var c=this;b.User.isLogin()?b.Api.get_carts(b.User.get_user_id(),b.Location.get_city_id(),c.params.item_id,function(b){c._initCart(b.data,a)},function(){c._initCart(!1,a)}):c._initCart(!1,a)},_initCart:function(c,d){this.cart=new b.CartClass(a.isArray(c)&&1===c.length&&c[0]||{}),this.cart.user_id=b.User.get_user_id(),this.cart.city_id=b.Location.get_city_id(),this.cart.station=b.Location.get_station_id(),b.debug&&b.d(JSON.stringify(this.cart)),d&&d()},addOrUpdateCart:function(a){if(this.cart.item_id=this.comboData.item_id,this.cart.material_price<this.item_price)return b.toast("您点的菜还不够餐厅起送标准，请继续点餐"),a(!1),!1;var c=this.cart.toObject();return this.cart.cart_id?b.Api.update_select_cart(b.User.get_user_id(),[c],function(b){a(!0)},function(){a(!1)}):(delete c.cart_id,b.Api.add_minus_cart(b.User.get_user_id(),c,function(b){a(!0)},function(){a(!1)})),!0}})}(mui,TS),function(a,b){a.os.plus&&(b.CombodetailPage=b.CombodetailPage.extend({init:function(){this.initConfig(),this.initPage(function(){b.closeWaiting()}),this.initEvent()},initConfig:function(){this._super(),a.plusReady(function(){plus.webview.currentWebview().setStyle({scrollIndicator:"none"})})},gotoMaterial:function(){a.fire(plus.webview.currentWebview().opener(),"addMaterial",{id:this.params.id}),this._super()}}))}(mui,TS);